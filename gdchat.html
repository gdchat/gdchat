<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ Chatbot GDCHAT</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        h1 {
            color: #4285F4;
            text-align: center;
        }
        
        h3 {
            text-align: center;
            color: #555;
            margin-top: -10px;
        }
        
        #chat-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        #chat-output {
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            background-color: white;
            line-height: 1.5;
        }
        
        #input-container {
            display: flex;
            padding: 10px;
            background-color: #f9f9f9;
            border-top: 1px solid #ddd;
        }
        
        #text-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        #button-container {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background-color: #f9f9f9;
            border-top: 1px solid #ddd;
        }
        
        button {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        #send-button {
            background-color: #34a853;
            color: white;
        }
        
        #clear-button {
            background-color: #ea4335;
            color: white;
        }
        
        #save-button {
            background-color: #4285F4;
            color: white;
        }
        
        .user-message {
            margin-bottom: 15px;
            color: #1a73e8;
        }
        
        .bot-message {
            margin-bottom: 15px;
            color: #5f6368;
        }
        
        .typing-indicator {
            color: #70757a;
            font-style: italic;
            margin-bottom: 15px;
        }
        
        .system-message {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 15px;
            padding: 8px;
            background-color: #f1f1f1;
            border-radius: 4px;
        }
        
        .timestamp {
            font-size: 0.8em;
            color: #999;
            margin-top: 5px;
        }
        
        @media (max-width: 600px) {
            #button-container {
                flex-direction: column;
                gap: 5px;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <h1>ü§ñ Chatbot GDCHAT</h1>
    <h3>Digite sua mensagem abaixo:</h3>
    
    <div id="chat-container">
        <div id="chat-output"></div>
        <div id="input-container">
            <input type="text" id="text-input" placeholder="Digite sua mensagem...">
        </div>
        <div id="button-container">
            <button id="send-button">
                <span>Enviar</span>
            </button>
            <button id="clear-button">
                <span>Limpar</span>
            </button>
            <button id="save-button">
                <span>Salvar</span>
            </button>
        </div>
    </div>

    <script>
        // Configuration
        const API_KEY = "AIzaSyAk-Hn7Ew2G2fF8wxZOG0ryCPs_CV214Fk";
        const MODEL_NAME = "gemini-2.0-flash";
        
        // DOM Elements
        const chatOutput = document.getElementById('chat-output');
        const textInput = document.getElementById('text-input');
        const sendButton = document.getElementById('send-button');
        const clearButton = document.getElementById('clear-button');
        const saveButton = document.getElementById('save-button');
        
        // Chat state
        let chatHistory = [];
        
        // Initialize the chat with welcome message
        function initChat() {
            addSystemMessage("=== Bem-vindo ao GDCHAT ===");
            addSystemMessage("Digite sua mensagem e clique em Enviar");
            addSystemMessage("Comandos especiais:");
            addSystemMessage("- 'sair', 'fim' ou 'exit' para encerrar");
            addSystemMessage("- Use 'Limpar' para reiniciar a conversa");
            addSystemMessage("- 'Salvar' guarda o hist√≥rico no arquivo");
        }
        
        // Add a message to the chat output
        function addMessage(role, content, isTyping = false) {
            const messageDiv = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString();
            
            if (isTyping) {
                messageDiv.className = 'typing-indicator';
                messageDiv.id = 'typing-indicator';
            } else if (role === 'system') {
                messageDiv.className = 'system-message';
            } else {
                messageDiv.className = role === 'user' ? 'user-message' : 'bot-message';
            }
            
            const rolePrefix = role === 'user' ? 'üë§ Voc√™' : 'ü§ñ GDCHAT';
            const displayContent = role === 'system' ? content : `${rolePrefix}: ${content}`;
            
            messageDiv.innerHTML = displayContent;
            
            if (!isTyping && role !== 'system') {
                const timeSpan = document.createElement('div');
                timeSpan.className = 'timestamp';
                timeSpan.textContent = timestamp;
                messageDiv.appendChild(timeSpan);
            }
            
            if (isTyping) {
                // Replace existing typing indicator if present
                const existingTyping = document.getElementById('typing-indicator');
                if (existingTyping) {
                    chatOutput.replaceChild(messageDiv, existingTyping);
                } else {
                    chatOutput.appendChild(messageDiv);
                }
            } else {
                // Remove typing indicator if present
                const typingIndicator = document.getElementById('typing-indicator');
                if (typingIndicator) {
                    chatOutput.removeChild(typingIndicator);
                }
                chatOutput.appendChild(messageDiv);
            }
            
            chatOutput.scrollTop = chatOutput.scrollHeight;
        }
        
        // Helper for system messages
        function addSystemMessage(content) {
            addMessage('system', content);
        }
        
        // Send message to Gemini API
        async function sendMessage(message) {
            // Add user message to chat
            addMessage('user', message);
            chatHistory.push({ role: 'user', parts: [{ text: message }] });
            
            // Show typing indicator
            addMessage('bot', 'GDCHAT est√° digitando...', true);
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: chatHistory,
                        generationConfig: {
                            temperature: 0.9,
                            topK: 1,
                            topP: 1,
                            maxOutputTokens: 2048,
                            stopSequences: []
                        },
                        safetySettings: [
                            {
                                category: "HARM_CATEGORY_HARASSMENT",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            },
                            {
                                category: "HARM_CATEGORY_HATE_SPEECH",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            },
                            {
                                category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            },
                            {
                                category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            }
                        ]
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.candidates && data.candidates[0].content.parts) {
                    const botResponse = data.candidates[0].content.parts[0].text;
                    addMessage('bot', botResponse);
                    chatHistory.push({ role: 'model', parts: [{ text: botResponse }] });
                } else {
                    throw new Error('Unexpected response format from API');
                }
            } catch (error) {
                addSystemMessage(`‚ùå Erro: ${error.message}`);
                console.error('Error:', error);
            }
        }
        
        // Save chat history to a file
        function saveChatHistory() {
            try {
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                const filename = `chat_history_${timestamp}.txt`;
                let content = '';
                
                chatHistory.forEach(message => {
                    const role = message.role === 'user' ? 'Voc√™' : 'GDCHAT';
                    content += `${role}: ${message.parts[0].text}\n\n`;
                });
                
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                addSystemMessage(`‚úÖ Conversa salva como ${filename}`);
                return filename;
            } catch (error) {
                addSystemMessage(`‚ùå Erro ao salvar: ${error.message}`);
                return null;
            }
        }
        
        // Clear the chat history
        function clearChat() {
            chatHistory = [];
            chatOutput.innerHTML = '';
            addSystemMessage("> Hist√≥rico limpo. Conversa reiniciada.");
        }
        
        // Event listeners
        sendButton.addEventListener('click', () => {
            const message = textInput.value.trim();
            textInput.value = '';
            
            if (!message) return;
            
            if (message.toLowerCase() === 'sair' || 
                message.toLowerCase() === 'exit' || 
                message.toLowerCase() === 'fim') {
                addSystemMessage("> Chat encerrado. At√© mais!");
                return;
            }
            
            sendMessage(message);
        });
        
        textInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendButton.click();
            }
        });
        
        clearButton.addEventListener('click', clearChat);
        saveButton.addEventListener('click', saveChatHistory);
        
        // Initialize the chat
        initChat();
    </script>
</body>
</html>